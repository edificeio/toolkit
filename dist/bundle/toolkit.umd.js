!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("axios")):"function"==typeof define&&define.amd?define(["exports","axios"],e):e(t.toolkit=t.toolkit||{},t.axios)}(this,function(t,e){"use strict";function n(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function i(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}c((i=i.apply(t,e)).next())})}function r(t){var e=[];return t.forEach(function(t){e.push(t)}),e}e="default"in e?e.default:e;var o,s=function(){function t(){}return t.extend=function(e,n,i){var r=this;for(var o in n)!function(){var s=n[o];if(i&&i[o]&&s){var c,u=i[o];c=u instanceof Function?{type:u,deps:[]}:{type:u.type,single:u.single,deps:u.deps?u.deps:[]};var h=function(e){var n=new((i=c.type).bind.apply(i,[void 0].concat(c.deps)));return n.mixin?n.mixin(e):t.extend(n,e),n;var i};s instanceof Array&&c.single?(e[o]=[],s.forEach(function(t){e[o].push(h(t))})):e[o]=h(s)}else!s||"object"!=typeof s||s instanceof Array?e[o]=s:e[o]instanceof a?e[o].load(s):(e[o]||(e[o]={}),r.extend(e[o],s))}();e&&e.fromJSON&&e.fromJSON(n)},t.castAs=function(t,e,n){void 0===n&&(n={});var i=new t(n);return this.extend(i,e),i},t.castArrayAs=function(e,n,i){void 0===i&&(i={});var r=[];return n.forEach(function(n){r.push(t.castAs(e,n,i))}),r},t}(),a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this)||this;return i.className=e,i.mixin=n,i}return n(e,t),e.prototype.push=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];return e.forEach(function(e){e instanceof t.className||(e=s.castAs(t.className,e));for(var n in t.mixin)e[n]=t.mixin[n];Array.prototype.push.call(t,e)}),this.length},e.prototype.load=function(t){var e=this;t.forEach(function(t){e.push(t)})},e.prototype.asArray=function(){return r(this)},e.prototype.toJSON=function(){return r(this)},e}(Array),c=function(){function t(){this.events=new Map}return t.prototype.trigger=function(t,e){this.events[t]&&this.events[t].forEach(function(t){return t(e)})},t.prototype.on=function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},t.prototype.off=function(t,e){if(this.events[t]){if(void 0===e)return void(this.events[t]=[]);var n=this.events[t].indexOf(e);-1!==n&&this.events[t].splice(n,1)}},t.prototype.once=function(t,e){var n=this,i=function(r){e(r),n.off(t,i)};this.on(t,i)},t}(),u=function(){function t(t){this.arr=t,this.selectedElements=[]}return Object.defineProperty(t.prototype,"all",{get:function(){return this.arr},set:function(t){this.arr=t},enumerable:!0,configurable:!0}),t.prototype.filter=function(t){return this.arr.filter(t)},t.prototype.push=function(t){this.arr.push(t)},t.prototype.addRange=function(t){for(var e=0;e<t.length;e++)this.all.push(t[e])},Object.defineProperty(t.prototype,"colLength",{get:function(){return this.arr.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.selected.length},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.arr.forEach(t)},t.prototype.selectAll=function(){for(var t=0;t<this.arr.length;t++)this.arr[t].selected=!0},t.prototype.select=function(t){for(var e=0;e<this.arr.length;e++)this.arr[e].selected=t(this.arr[e])},t.prototype.deselect=function(t){for(var e=0;e<this.arr.length;e++)this.arr[e].selected=!t(this.arr[e])},t.prototype.deselectAll=function(){for(var t=0;t<this.arr.length;t++)this.arr[t].selected=!1},t.prototype.removeSelection=function(){for(var t=[],e=0;e<this.arr.length;e++)this.arr[e].selected||t.push(this.arr[e]);this.arr.splice(0,this.arr.length);for(var e=0;e<t.length;e++)this.arr.push(t[e])},t.prototype.updateSelected=function(){for(var t=0;t<this.arr.length;t++){var e=this.selectedElements.indexOf(this.arr[t]);this.arr[t].selected&&-1===e?this.selectedElements.push(this.arr[t]):this.arr[t].selected||-1===e||this.selectedElements.splice(e,1)}for(var t=0;t<this.selectedElements.length;t++){var e=this.arr.indexOf(this.selectedElements[t]);-1===e&&this.selectedElements.splice(e,1)}},Object.defineProperty(t.prototype,"selected",{get:function(){return this.updateSelected(),this.selectedElements},enumerable:!0,configurable:!0}),t}(),h=function(){function t(t,e,n,i,r){this.api=t,this.model=e,this.initialCast=n,this.childrenCasts=i,this.customMixin=r}return t.prototype.parseApi=function(t,e){var n=this;return"function"==typeof t&&(t=t()),t.split(/(:[a-zA-Z0-9_.]+)/).map(function(t){return":"===t.charAt(0)?e&&e[t.substr(1)]||n.model[t.substr(1)]||n[t.substr(1)]||t:t}).join("")},t.prototype.defaultMixin=function(t){var e=this;if(t instanceof Array&&this.model instanceof Array){this.model=[];var n=this.model;t.forEach(function(t){var i={};e.initialCast&&(i=e.initialCast instanceof Function?new e.initialCast:new((r=e.initialCast.type).bind.apply(r,[void 0].concat(e.initialCast.deps)))),s.extend(i,t,e.childrenCasts),n.push(i);var r})}else s.extend(this.model,t,this.childrenCasts)},t.prototype.create=function(t,e){var n=this;if(void 0===e&&(e={}),!this.api.create)throw'[Crud][Api] "create" route is undefined';return this.http.post(this.parseApi(this.api.create,t),t||this.model,e).then(function(e){return n.model instanceof Array&&n.model.push(t),e})},t.prototype.sync=function(t){var e=this;if(void 0===t&&(t={}),!this.api.sync)throw'[Crud][Api] "sync" route is undefined';return this.http.get(this.parseApi(this.api.sync),t).then(function(t){return(e.customMixin||e.defaultMixin).bind(e)(t.data),t})},t.prototype.update=function(t,e){if(void 0===e&&(e={}),!this.api.update)throw'[Crud][Api] "update" route is undefined';return this.http.put(this.parseApi(this.api.update,t),t||this.model,e)},t.prototype.delete=function(t,e){var n=this;if(void 0===e&&(e={}),!this.api.delete)throw'[Crud][Api] "delete" route is undefined';return this.http.delete(this.parseApi(this.api.delete,t),e).then(function(e){if(n.model instanceof Array){-1!==n.model.indexOf(t)&&n.model.splice(n.model.indexOf(t),1)}return e})},t}(),f=function(t){function i(){var n=t.apply(this,arguments)||this;return n.http=e,n}return n(i,t),i}(h),p=function(t){function e(e,n,i){var r=t.call(this,e,null,n,i)||this;return r.data=[],r.model=r.data,r.customMixin=r.mixin,r}return n(e,t),e.prototype.mixin=function(t){var e=this;if(!(t&&t instanceof Array))throw"[Crud][Collection] An Array payload is expected.";this.data=[],t.forEach(function(t){var n={};e.initialCast&&(n=e.initialCast instanceof Function?new e.initialCast:new((i=e.initialCast.type).bind.apply(i,[void 0].concat(e.initialCast.deps)))),s.extend(n,t,e.childrenCasts),e.data.push(n);var i})},e}(h),l=function(t){function i(n,i,r){var o=t.call(this,n,i,r)||this;return o.http=e,o}return n(i,t),i}(p),d=function(t){function e(e,n){var i=t.call(this,e,null,null,n)||this;return i.model=i,i.customMixin=i.mixin,i}return n(e,t),e.prototype.mixin=function(t){if(!(t&&t instanceof Object))throw"[Crud][Collection] An Object payload is expected.";s.extend(this,t,this.childrenCasts)},e}(h),y=function(t){function i(n,i){var r=t.call(this,n,i)||this;return r.http=e,r}return n(i,t),i}(d),v=function(){function t(t,e){this.path=t,this.className=e,this._data=[],this.eventer=new c}return t.prototype.data=function(){return i(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isSynced||this.syncing?[3,2]:[4,this.sync()];case 1:t.sent(),t.label=2;case 2:return this.syncing?[4,this.syncDone()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,this._data]}})})},t.prototype.syncDone=function(){return i(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e,n){t.eventer.once("sync",function(){return e()})})]})})},t.prototype.sync=function(){return i(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return this.syncing=!0,[4,e.get(this.path)];case 1:return t=n.sent(),this._data=s.castArrayAs(this.className,t.data),this.isSynced=!0,this.eventer.trigger("sync"),this.syncing=!1,[2]}})})},t.prototype.refresh=function(){return i(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isSynced=!1,[4,this.sync()];case 1:return t.sent(),this.eventer.trigger("refresh"),[2]}})})},t.prototype.push=function(t){this._data.push(t)},t.prototype.remove=function(t){var e=this._data.indexOf(t);-1!==e&&this._data.splice(e,1)},t}(),m=[],g=!1,x=function(){m.forEach(function(t){t._backup!==JSON.stringify(t.model)&&(t.fn?t.fn():e[t.method](t.path,t.model),t._backup=JSON.stringify(t.model))}),g=!0,o=setTimeout(x,500)},A=function(){function t(){}return t.watch=function(t,e,n){if(void 0===n&&(n="put"),-1===m.findIndex(function(n){return n.model===e&&n.path===t})){var i;i="string"==typeof t?{model:e,path:t,method:n}:{model:e,fn:t,method:n},m.push(i),g||x()}},t.unwatch=function(t){var e=m.findIndex(function(e){return e.model===t});m.splice(e,1),0===m.length&&this.unwatchAll()},t.unwatchAll=function(){m=[],clearTimeout(o),g=!1},t}();t.Mix=s,t.TypedArray=a,t.Eventer=c,t.Selection=u,t.AbstractCrud=h,t.Crud=f,t.AbstractCollection=p,t.Collection=l,t.AbstractModel=d,t.Model=y,t.Provider=v,t.Autosave=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=toolkit.umd.js.map
